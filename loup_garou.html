<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Loup-Garou</title>
<style>
body { font-family: Arial; background:#222; color:#eee; text-align:center; padding:20px; }
#log { width:80%; max-width:800px; height:400px; background:#111; border:2px solid #555; border-radius:8px; padding:10px; overflow-y:auto; margin-bottom:10px; text-align:left;}
#inputZone { display:flex; gap:10px; justify-content:center; margin-bottom:10px;}
#message { flex:1; padding:8px; font-size:16px; border-radius:5px; border:1px solid #444; }
button { padding:8px 15px; font-size:16px; border:none; border-radius:5px; cursor:pointer; background:#444; color:#eee; }
button:hover { background:#666; }
#defendBtn { background:#a33; }
#defendBtn:hover { background:#d55; }
</style>
</head>
<body>
<h1>Jeu du Loup-Garou</h1>
<div id="log"></div>
<div id="inputZone">
<input id="message" type="text" maxlength="20" placeholder="√âcris ton message (20 max)">
<button id="talkBtn" onclick="parler()">Parler</button>
<button id="defendBtn" onclick="seDefendre()" disabled>Se d√©fendre</button>
</div>

<script>
// ---------- CONFIG ----------
const TOTAL_PLAYERS = 8;
const NUM_WOLVES = 2;

// ---------- INIT ----------
const BOT_PERSONALITIES = ["m√©fiant", "cr√©dules", "menteur", "neutre", "suiveur"];
let players = [];
let human;
let roundNum = 1;
let running = true;
let suspected = null;
let awaitingHuman = false;

const log = document.getElementById("log");
const talkBtn = document.getElementById("talkBtn");
const defendBtn = document.getElementById("defendBtn");

function addText(msg){
    log.innerHTML += msg + "<br>";
    log.scrollTop = log.scrollHeight;
}

function createPlayers(){
    let humanIndex = Math.floor(Math.random()*TOTAL_PLAYERS);
    for(let i=0;i<TOTAL_PLAYERS;i++){
        let p = {
            name: "J"+(i+1),
            role: "Villageois",
            alive: true,
            isHuman: i===humanIndex,
            personality: BOT_PERSONALITIES[Math.floor(Math.random()*BOT_PERSONALITIES.length)]
        };
        players.push(p);
        if(p.isHuman) human = p;
    }
}

function assignRoles(){
    let wolves = [];
    while(wolves.length<NUM_WOLVES){
        let choice = players[Math.floor(Math.random()*players.length)];
        if(choice.role==="Villageois"){
            choice.role="Loup";
            wolves.push(choice);
        }
    }
}

function alivePlayers(){ return players.filter(p=>p.alive); }
function aliveWolves(){ return players.filter(p=>p.alive && p.role==="Loup"); }
function aliveNonWolves(){ return players.filter(p=>p.alive && p.role!=="Loup"); }

// ---------- TOUR ----------
function nextRound(){
    if(!running) return;
    addText(`<b>===== Tour ${roundNum} =====</b>`);
    setTimeout(nightPhase,1500);
}

function nightPhase(){
    addText("<i>--- Nuit ---</i>");
    let wolves = aliveWolves();
    if(wolves.length>0){
        let candidates = alivePlayers().filter(p=>!wolves.includes(p));
        if(candidates.length>0){
            let victim = candidates[Math.floor(Math.random()*candidates.length)];
            victim.alive=false;
            addText(`üê∫ Cette nuit, ${victim.name} a √©t√© TU√â(e) !`);
        } else addText("Cette nuit, personne n‚Äôa √©t√© tu√©.");
    }
    setTimeout(dayPhase,2500);
}

function dayPhase(){
    addText("<i>--- Jour ---</i>");
    let alive = alivePlayers();
    addText("En vie : " + alive.map(p=>p.name).join(", "));
    addText("Discussion : tape ton message et clique 'Parler'");

    suspected = null;
    awaitingHuman = true;
    talkBtn.disabled = false;
}

// ---------- INTERACTION HUMAIN ----------
function parler(){
    if(!awaitingHuman) return;
    const input = document.getElementById("message");
    const txt = input.value.trim();
    if(!txt) return;
    addText(`<b>J1 (Toi) :</b> ${txt}`);
    input.value="";
    talkBtn.disabled = true;
    awaitingHuman = false;

    // r√©actions bots
    let alive = alivePlayers();
    let i = 1;
    function botsReagissent(){
        if(i<alive.length){
            let p = alive[i];
            if(!p.isHuman){
                const reactions=["Je te crois !","Peut-√™tre... je ne sais pas.","Je t'ignore.","Tu me sembles suspect !"];
                let line = reactions[Math.floor(Math.random()*reactions.length)];
                addText(`${p.name} : ${line}`);
                if(line.includes("suspect")) suspected = human;
            }
            i++;
            setTimeout(botsReagissent,1500);
        } else {
            if(suspected===human){
                addText("<b>‚ö†Ô∏è Tu es soup√ßonn√© ! Clique sur 'Se d√©fendre'</b>");
                defendBtn.disabled=false;
            } else {
                prepareVote();
            }
        }
    }
    setTimeout(botsReagissent,1000);
}

function seDefendre(){
    if(!suspected) return;
    const roll=Math.random();
    if(roll<0.5) addText("üëâ Tu te d√©fends bien, certains changent d'avis !");
    else if(roll<0.7) addText("‚ùå Ta d√©fense est mauvaise, tu sembles encore plus suspect...");
    else addText("üòê Tu t'expliques, mais personne ne t'√©coute.");
    defendBtn.disabled=true;
    prepareVote();
}

// ---------- VOTE ----------
function prepareVote(){
    setTimeout(()=>{
        let alive = alivePlayers();
        if(alive.length<=1){ addText("Fin de la partie !"); running=false; return; }
        let votes = {};
        alive.forEach(p=>votes[p.name]=0);
        if(suspected) votes[suspected.name]++;
        alive.forEach(p=>{
            if(!p.isHuman){
                let target = alive[Math.floor(Math.random()*alive.length)];
                votes[target.name]++;
                addText(`${p.name} vote pour ${target.name}`);
            }
        });
        let sorted = Object.entries(votes).sort((a,b)=>b[1]-a[1]);
        let executedName = sorted[0][0];
        let executed = players.find(p=>p.name===executedName);
        executed.alive=false;
        addText(`‚öñÔ∏è ${executed.name} a √©t√© √©limin√©(e) !`);
        let winner = checkWin();
        if(winner){ addText(`<b>=== FIN === Victoire des ${winner} !</b>`); running=false; }
        else{ roundNum++; setTimeout(nextRound,2000); }
    },1500);
}

function checkWin(){
    if(aliveWolves().length===0) return "Villageois";
    if(aliveWolves().length>=aliveNonWolves().length) return "Loups";
    return null;
}

// ---------- LANCEMENT ----------
createPlayers();
assignRoles();
addText("Bienvenue au Loup-Garou ! Ton r√¥le secret est Villageois.");
setTimeout(nextRound,2000);

</script>
</body>
</html>
