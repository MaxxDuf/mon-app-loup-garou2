<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Loup-Garou Navigateur</title>
<style>
body { background:black; color:lime; font-family:Consolas, monospace; }
#log { width:90%; height:400px; overflow-y:auto; border:1px solid lime; padding:5px; margin-bottom:10px; }
#entry { width:70%; }
button { margin:3px; padding:5px 10px; border-radius:5px; }
#nightActions,#vote,#cite{margin-top:10px;}
</style>
</head>
<body>

<h2>Jeu du Loup-Garou</h2>
<div id="log"></div>

<div>
<input id="entry" placeholder="√âcris ici...">
<button onclick="humanTalk()">Parler</button>
<button id="defendBtn" onclick="humanDefend()" disabled>Se d√©fendre</button>
</div>

<div id="cite"></div>
<div id="vote"></div>
<div id="nightActions"></div>

<script>
// --------------- CONFIG ----------------
const TOTAL_PLAYERS=8;
const NUM_WOLVES=2;
const HAS_SEER=true;
const HAS_DOCTOR=true;
const BOT_PERSONALITIES=["m√©fiant","cr√©dules","menteur","neutre","suiveur"];

// --------------- CLASSES ---------------
class Player{
    constructor(name,isHuman=false){
        this.name=name;
        this.isHuman=isHuman;
        this.role="Villageois";
        this.alive=true;
        this.personality=BOT_PERSONALITIES[Math.floor(Math.random()*BOT_PERSONALITIES.length)];
    }
}

// --------------- INIT ------------------
let players=[],human,roundNum=1,running=true,suspected=null;
createPlayers();
assignRoles();
addText("Bienvenue au Loup-Garou !");
addText(`Ton r√¥le secret est : ${human.role}`);
showRoleInstructions(human.role);

// --------------- FUNCTIONS ------------
function addText(msg){ 
    let log=document.getElementById("log");
    log.innerHTML+=msg+"<br>";
    log.scrollTop=log.scrollHeight;
}
function alivePlayers(){return players.filter(p=>p.alive);}
function aliveWolves(){return players.filter(p=>p.alive&&p.role==="Loup");}
function aliveNonWolves(){return players.filter(p=>p.alive&&p.role!=="Loup");}

// ----------------- CREATION & ROLES ----------------
function createPlayers(){
    let humanIndex=Math.floor(Math.random()*TOTAL_PLAYERS);
    for(let i=0;i<TOTAL_PLAYERS;i++){
        let p=new Player(`Joueur${i+1}`,i===humanIndex);
        players.push(p);
        if(i===humanIndex){p.name="Toi"; human=p;}
    }
}
function assignRoles(){
    let wolves=[...players].sort(()=>0.5-Math.random()).slice(0,NUM_WOLVES);
    wolves.forEach(w=>w.role="Loup");
    let remaining=players.filter(p=>p.role==="Villageois");
    if(HAS_SEER) remaining[Math.floor(Math.random()*remaining.length)].role="Voyante";
    if(HAS_DOCTOR) remaining[Math.floor(Math.random()*remaining.length)].role="Medecin";
}

// ----------------- ROLE INSTRUCTIONS -----------------
function showRoleInstructions(role){
    let instructions="";
    switch(role){
        case "Loup":
            instructions="‚ö†Ô∏è Tu es un Loup-Garou ! Chaque nuit, tu peux choisir une victime √† tuer.";
            break;
        case "Voyante":
            instructions="üîÆ Tu es la Voyante ! Chaque nuit, tu peux d√©couvrir le r√¥le d'un joueur.";
            break;
        case "Medecin":
            instructions="üíâ Tu es le M√©decin ! Chaque nuit, tu peux sauver un joueur de la mort.";
            break;
        case "Villageois":
            instructions="üè° Tu es un Villageois ! Ton but est d'aider √† d√©masquer les Loups-Garous et √† survivre.";
            break;
    }
    alert(instructions);
}

// ----------------- NIGHT PHASE -----------------
function nightPhase(){
    addText(`\n===== Tour ${roundNum} : Nuit =====`);
    let container=document.getElementById("nightActions");
    container.innerHTML="";
    let alive=alivePlayers();
    let victim=null, save=null;

    // Actions humaines
    if(human.role==="Loup"){
        container.innerHTML="<h3>Choisis une victime :</h3>";
        alive.forEach(p=>{
            if(p!==human){
                let btn=document.createElement("button");
                btn.textContent=p.name;
                btn.onclick=()=>{
                    victim=p;
                    addText(`Tu choisis de tuer ${p.name} cette nuit !`);
                    container.innerHTML="";
                    proceedNight();
                };
                container.appendChild(btn);
            }
        });
        return;
    }
    if(human.role==="Medecin"){
        container.innerHTML="<h3>Choisis un joueur √† sauver :</h3>";
        alive.forEach(p=>{
            let btn=document.createElement("button");
            btn.textContent=p.name;
            btn.onclick=()=>{
                save=p;
                addText(`üíâ Tu sauves ${p.name} cette nuit !`);
                container.innerHTML="";
                proceedNight();
            };
            container.appendChild(btn);
        });
        return;
    }
    if(human.role==="Voyante"){
        container.innerHTML="<h3>Choisis un joueur √† d√©couvrir :</h3>";
        alive.forEach(p=>{
            if(p!==human){
                let btn=document.createElement("button");
                btn.textContent=p.name;
                btn.onclick=()=>{
                    alert(`${p.name} est ${p.role}`);
                    container.innerHTML="";
                    proceedNight();
                };
                container.appendChild(btn);
            }
        });
        return;
    }

    proceedNight();

    function proceedNight(){
        // Loups bots tuent
        let wolves=aliveWolves().filter(p=>!p.isHuman);
        let candidates=alive.filter(p=>!wolves.includes(p));
        if(candidates.length>0){
            let randomVictim=candidates[Math.floor(Math.random()*candidates.length)];
            victim=victim || randomVictim;
        }
        // M√©decin humain ou bot sauve
        if(save===victim){victim=null;}
        if(victim){victim.alive=false; addText(`${victim.name} a √©t√© tu√© cette nuit !`);}
        else addText("Personne n‚Äôa √©t√© tu√© cette nuit.");
        setTimeout(dayPhase,1000);
    }
}

// ----------------- DAY PHASE -----------------
function dayPhase(){
    addText(`\n===== Tour ${roundNum} : Jour =====`);
    let alive=alivePlayers();
    addText("En vie : "+alive.map(p=>p.name).join(", "));
    addText("Les villageois discutent...");
    prepareVote();
}

// ----------------- HUMAN TALK -----------------
function humanTalk(){
    let text=document.getElementById("entry").value.trim();
    document.getElementById("entry").value="";
    if(!text) return;
    addText(`Toi dis : ${text}`);
}

// ----------------- DEFENSE -----------------
function humanDefend(){
    let roll=Math.random();
    if(roll<0.5) addText("üëâ Tu te d√©fends bien !");
    else if(roll<0.7) addText("‚ùå Ta d√©fense est mauvaise...");
    else addText("üòê Tu t'expliques mais personne n'√©coute.");
    document.getElementById("defendBtn").disabled=true;
}

// ----------------- VOTE -----------------
function prepareVote(){
    let container=document.getElementById("vote");
    container.innerHTML="<h3>Votez pour √©liminer :</h3>";
    let alive=alivePlayers();
    alive.forEach(p=>{
        if(p!==human){
            let btn=document.createElement("button");
            btn.textContent=p.name;
            btn.onclick=()=>{
                vote(p);
                container.innerHTML="";
            };
            container.appendChild(btn);
        }
    });
}

function vote(choice){
    let votes={};
    votes[choice.name]=1;
    alivePlayers().forEach(p=>{
        if(!p.isHuman){
            let targets=alivePlayers().filter(x=>x!==p);
            let target=targets[Math.floor(Math.random()*targets.length)];
            votes[target.name]=votes[target.name]?votes[target.name]+1:1;
            addText(`${p.name} vote pour ${target.name}`);
        }
    });
    let eliminatedName=Object.keys(votes).reduce((a,b)=>votes[a]>votes[b]?a:b);
    let eliminated=players.find(p=>p.name===eliminatedName);
    eliminated.alive=false;
    addText(`${eliminated.name} a √©t√© √©limin√©. Son r√¥le √©tait ${eliminated.role}`);
    checkWin();
}

function checkWin(){
    let wolves=aliveWolves();
    let nonWolves=aliveNonWolves();
    if(wolves.length===0){addText("üèÜ Les Villageois ont gagn√© !"); running=false; return;}
    if(wolves.length>=nonWolves.length){addText("üèÜ Les Loups-Garous ont gagn√© !"); running=false; return;}
    if(running){ roundNum++; setTimeout(nightPhase,1000);}
}

// --------------- LANCEMENT AUTOMATIQUE ---------------
setTimeout(nightPhase,1000);
</script>
</body>
</html>
