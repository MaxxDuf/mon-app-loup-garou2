<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Jeu du Loup-Garou</title>
    <style>
        body { font-family: Arial, sans-serif; background:#222; color:#eee; text-align:center; }
        #game { max-width:600px; margin:20px auto; background:#333; padding:20px; border-radius:10px; }
        button { margin:5px; padding:10px; border:none; border-radius:5px; cursor:pointer; background:#555; color:#fff; }
        button:disabled { background:#444; cursor:not-allowed; }
        #log { height:300px; overflow-y:auto; text-align:left; border:1px solid #555; padding:10px; margin-top:10px; background:#111; }
    </style>
</head>
<body>
<div id="game">
    <h1>Jeu du Loup-Garou</h1>
    <div id="log"></div>
    <div id="actions">
        <button id="startBtn">Commencer la partie</button>
        <button id="killBtn" style="display:none;">Tuer un joueur</button>
        <button id="defendBtn" style="display:none;">Se d√©fendre</button>
    </div>
</div>
<script>
let players=[];
let human=null;
let roundNum=0;
let suspected=null;

function addText(txt){
    let log=document.getElementById("log");
    log.innerHTML+=txt+"<br>";
    log.scrollTop=log.scrollHeight;
}

function createPlayers(){
    players=[
        {name:"Toi", role:null, alive:true, isHuman:true},
        {name:"√âvie", role:null, alive:true, personality:"m√©fiant"},
        {name:"Pok√©l√©", role:null, alive:true, personality:"cr√©dules"},
        {name:"Maxduf", role:null, alive:true, personality:"menteur"},
        {name:"Zo√©", role:null, alive:true, personality:"suiveur"},
    ];
    human=players[0];
    assignRoles();
}

function assignRoles(){
    let wolves=1;
    let villagers=players.length-wolves;
    let roles=["Loup"];
    for(let i=0;i<villagers;i++) roles.push("Villageois");
    roles.sort(()=>Math.random()-0.5);
    players.forEach((p,i)=>{ p.role=roles[i]; });
    addText("üé≠ R√¥les attribu√©s !");
    addText("Ton r√¥le : "+human.role);
}

function startGame(){
    document.getElementById("startBtn").style.display="none";
    gameLoop();
}

function alivePlayers(){ return players.filter(p=>p.alive); }
function wolvesAlive(){ return players.filter(p=>p.alive && p.role==="Loup"); }
function villagersAlive(){ return players.filter(p=>p.alive && p.role==="Villageois" && !p.isHuman); }

function gameLoop(){
    if(wolvesAlive().length===0){ addText("üéâ Les villageois ont gagn√© !"); return; }
    if(wolvesAlive().length>=villagersAlive().length){ addText("üê∫ Les loups ont gagn√© !"); return; }
    roundNum++;
    nightPhase();
}

function nightPhase(){
    addText(`\n===== Tour ${roundNum} : Nuit =====`);
    if(human.role==="Loup" && human.alive){
        addText("üåô Tu es loup. Choisis ta victime.");
        document.getElementById("killBtn").style.display="inline";
    } else {
        // Les loups bots attaquent
        let wolf=wolvesAlive()[0];
        if(wolf && !wolf.isHuman){
            let targets=alivePlayers().filter(p=>p.role!=="Loup");
            let victim=targets[Math.floor(Math.random()*targets.length)];
            victim.alive=false;
            addText(`üê∫ ${wolf.name} attaque ${victim.name} !`);
        }
        setTimeout(dayPhase,1000);
    }
}

document.getElementById("killBtn").onclick=function(){
    let targets=alivePlayers().filter(p=>p!==human);
    if(targets.length===0) return;
    let victim=targets[Math.floor(Math.random()*targets.length)];
    victim.alive=false;
    addText(`üê∫ Tu as tu√© ${victim.name}.`);
    document.getElementById("killBtn").style.display="none";
    setTimeout(dayPhase,1000);
};

function dayPhase(){
    addText(`\n===== Tour ${roundNum} : Jour =====`);
    let alive=alivePlayers();
    addText("En vie : "+alive.map(p=>p.name).join(", "));
    addText("üí¨ Les villageois discutent...");

    // Discussion automatique
    suspected=null;
    alive.forEach(p=>{
        if(!p.isHuman){
            let target = alive[Math.floor(Math.random()*alive.length)];
            if(target===p) return;
            let line="";
            if(p.role==="Loup" && Math.random()<0.5){
                line=`Je pense que ${target.name} est louche !`;
                suspected=target;
            } else {
                switch(p.personality){
                    case "m√©fiant": line=`Je me m√©fie de ${target.name}.`; suspected=target; break;
                    case "cr√©dules": line=`Je crois que ${target.name} est innocent.`; break;
                    case "menteur": line=`Je suis s√ªr que ${target.name} est un loup !`; suspected=target; break;
                    case "suiveur": line=`Je suivrai ce que les autres disent.`; break;
                    default: line="Je ne sais pas qui accuser.";
                }
            }
            addText(`${p.name} (${p.personality}) dit : ${line}`);
        }
    });

    // Si toi tu es soup√ßonn√©
    if(suspected===human){
        addText("‚ö†Ô∏è Tu es soup√ßonn√© ! Tu peux te d√©fendre.");
        document.getElementById("defendBtn").style.display="inline";
    } else {
        document.getElementById("defendBtn").style.display="none";
    }

    prepareVote();
}

document.getElementById("defendBtn").onclick=function(){
    addText("üó£Ô∏è Tu te d√©fends : 'Je ne suis pas un loup !'");
    document.getElementById("defendBtn").style.display="none";
};

function prepareVote(){
    setTimeout(votePhase,2000);
}

function votePhase(){
    let alive=alivePlayers();
    let votes={};
    alive.forEach(p=>votes[p.name]=0);
    alive.forEach(p=>{
        if(!p.isHuman){
            let target = suspected || alive[Math.floor(Math.random()*alive.length)];
            votes[target.name]++;
        }
    });
    // Vote du joueur
    if(suspected){ votes[suspected.name]++; }

    // R√©sultat
    let sorted=Object.entries(votes).sort((a,b)=>b[1]-a[1]);
    let executedName=sorted[0][0];
    let executed=players.find(p=>p.name===executedName);
    executed.alive=false;
    addText(`‚öñÔ∏è ${executed.name} est ex√©cut√© par vote (${votes[executed.name]} voix).`);
    setTimeout(gameLoop,1500);
}

document.getElementById("startBtn").onclick=createPlayers;
document.getElementById("startBtn").addEventListener("click",startGame);
</script>
</body>
</html>
